<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ReportManager - Valmet QCS</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header>
    <h1>üìã ReportManager</h1>
    <p class="subtitle">Informes QCS</p>
  </header>

  <!-- Tab Navigation -->
  <nav class="tab-navigation">
    <button class="tab-btn active" data-tab="datos">
      <span class="tab-icon">üìã</span>
      <span class="tab-label">Datos</span>
    </button>
    <button class="tab-btn" data-tab="verificacion">
      <span class="tab-icon">‚öôÔ∏è</span>
      <span class="tab-label">Verificaci√≥n</span>
    </button>
  </nav>

  <main>
    <!-- Tab Content: Datos Generales -->
    <div class="tab-content active" id="tab-datos">
      <section class="card">
        <h2>üìã Datos Generales</h2>
      
      <!-- 1¬™ LINHA: Empresa (3/4) e Data (1/4) -->
      <div class="form-row">
        <div class="form-field" style="flex: 3;">
          <label for="empresa">Empresa</label>
          <input type="text" id="empresa" placeholder="Nombre de la empresa">
        </div>
        <div class="form-field" style="flex: 1;">
          <label for="fecha-visita">Fecha de la Visita</label>
          <input type="date" id="fecha-visita">
        </div>
      </div>

      <!-- 2¬™ LINHA: Direcci√≥n -->
      <div class="form-field">
        <label for="direccion">Direcci√≥n</label>
        <input type="text" id="direccion" placeholder="Direcci√≥n completa">
      </div>

      <!-- 3¬™ LINHA: A√±o - Semana - Albar√°n - C√≥digo Ingeniero -->
      <div class="form-row">
        <div class="form-field">
          <label for="a√±o">A√±o</label>
          <input type="number" id="a√±o" placeholder="2025">
        </div>
        <div class="form-field">
          <label for="semana">Semana</label>
          <input type="number" id="semana" placeholder="1-52">
        </div>
        <div class="form-field">
          <label for="albaran">Albar√°n (N¬∫ de Proyecto)</label>
          <input type="text" id="albaran" placeholder="N√∫mero de albar√°n">
        </div>
        <div class="form-field">
          <label for="cod-ingeniero">C√≥digo Ingeniero</label>
          <input type="text" id="cod-ingeniero" placeholder="C√≥digo">
        </div>
      </div>

      <!-- 4¬™ LINHA: Perfiles en el aire -->
      <div class="form-field">
        <label for="perfiles">Perfiles en el aire</label>
        <textarea id="perfiles" rows="3" placeholder="Perfiles..."></textarea>
      </div>

      <!-- 5¬™ LINHA: Peticiones del cliente -->
      <div class="form-field">
        <label for="peticiones">Peticiones del cliente</label>
        <textarea id="peticiones" rows="3" placeholder="Peticiones..."></textarea>
      </div>

      <!-- Horas Trabajadas -->
      <div class="form-field">
        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">‚è±Ô∏è Horas Trabajadas</h3>
        <div class="hours-table-container">
          <table class="hours-table" id="hours-table">
            <thead>
              <tr>
                <th>D√çAS</th>
                <th>FECHAS</th>
                <th>Horas de Viaje</th>
                <th>Horas normales<br>8h00...20h00<br>(Max 8 hrs)</th>
                <th>Horas Extras<br>20h00...8h00<br>(of&gt; 8 hrs)</th>
                <th>Horas<br>Sabados</th>
                <th>Horas Feriadas<br>y Domingos</th>
                <th>Commentarios</th>
              </tr>
            </thead>
            <tbody>
              <tr data-day="LUN">
                <td>LUN.</td>
                <td><input type="date" class="date-input" data-day="LUN"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="LUN" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="MAR">
                <td>MAR.</td>
                <td><input type="date" class="date-input" data-day="MAR"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="MAR" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="MIER">
                <td>MIER.</td>
                <td><input type="date" class="date-input" data-day="MIER"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="MIER" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="JUE">
                <td>JUE.</td>
                <td><input type="date" class="date-input" data-day="JUE"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="JUE" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="VIER">
                <td>VIER.</td>
                <td><input type="date" class="date-input" data-day="VIER"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="VIER" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="SAB">
                <td>SAB.</td>
                <td><input type="date" class="date-input" data-day="SAB"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="SAB" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="DOM">
                <td>DOM.</td>
                <td><input type="date" class="date-input" data-day="DOM"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="DOM" placeholder="Comentarios..."></td>
              </tr>
              <tr class="total-row">
                <td colspan="2"><strong>TOTAL Hrs</strong></td>
                <td><strong id="total-viaje">0</strong></td>
                <td><strong id="total-normales">0</strong></td>
                <td><strong id="total-extras">0</strong></td>
                <td><strong id="total-sabados">0</strong></td>
                <td><strong id="total-feriados">0</strong></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Firmas Digitales -->
    <section class="card">
      <h2>‚úçÔ∏è Firmas Digitales</h2>
      <div class="firmas-container">
        <!-- Firma Ingeniero -->
        <div class="signature-section">
          <h3>Ingeniero Valmet</h3>
          <div class="form-field">
            <label for="nombre-ingeniero">Nombre completo</label>
            <input type="text" id="nombre-ingeniero" placeholder="Nombre del ingeniero">
          </div>
          <div class="signature-pad-container" id="signature-ingeniero-container" data-signature="ingeniero">
            <div class="signature-placeholder">
              ‚úçÔ∏è Toque aqu√≠ para firmar
            </div>
          </div>
        </div>

        <!-- Firma Cliente -->
        <div class="signature-section">
          <h3>Cliente</h3>
          <div class="form-field">
            <label for="nombre-cliente-firma">Nombre completo</label>
            <input type="text" id="nombre-cliente-firma" placeholder="Nombre del cliente">
          </div>
          <div class="signature-pad-container" id="signature-cliente-container" data-signature="cliente">
            <div class="signature-placeholder">
              ‚úçÔ∏è Toque aqu√≠ para firmar
            </div>
          </div>
        </div>
      </div>
    </section>
    </div>

    <!-- Tab Content: Verificaci√≥n -->
    <div class="tab-content" id="tab-verificacion">
      <section class="card">
        <h2>‚öôÔ∏è Verificaci√≥n de Sistemas</h2>
        <p class="subtitle">Seleccione los estados de cada elemento</p>
        <div id="sections-container"></div>
      </section>

      <!-- Acciones Correctivas -->
      <section class="card collapsed-section">
        <div class="section-header-collapse" onclick="app.toggleCollapse(this)">
          <h2>üîß Acciones Correctivas</h2>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="section-content" style="display: none;">
          <button type="button" id="add-accion-correctiva" class="btn btn-primary" style="margin-bottom: 1rem;">
            ‚ûï A√±adir Acci√≥n Correctiva
          </button>
          <div id="acciones-correctivas-container"></div>
        </div>
      </section>

      <!-- Recomendaciones -->
      <section class="card collapsed-section">
        <div class="section-header-collapse" onclick="app.toggleCollapse(this)">
          <h2>üí° Recomendaciones</h2>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="section-content" style="display: none;">
          <div class="form-field">
            <textarea id="recomendaciones" rows="5" placeholder="Recomendaciones..."></textarea>
            <div class="item-photos-gallery">
              <button class="btn-add-photo" onclick="app.openGeneralPhoto('recomendaciones')">üì∑ +</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Conclusi√≥n -->
      <section class="card collapsed-section">
        <div class="section-header-collapse" onclick="app.toggleCollapse(this)">
          <h2>‚úÖ Conclusi√≥n</h2>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="section-content" style="display: none;">
          <div class="form-field">
            <textarea id="conclusion" rows="5" placeholder="Conclusi√≥n..."></textarea>
            <div class="item-photos-gallery">
              <button class="btn-add-photo" onclick="app.openGeneralPhoto('conclusion')">üì∑ +</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Tab Content: Firmas -->
    <div class="tab-content" id="tab-firmas">
      <section class="card">
        <h2>‚úçÔ∏è Firmas Digitales</h2>
        
        <!-- Firma Ingeniero -->
        <div class="signature-section">
          <h3>Ingeniero Valmet</h3>
          <div class="form-field">
            <label for="nombre-ingeniero">Nombre completo</label>
            <input type="text" id="nombre-ingeniero" placeholder="Nombre del ingeniero">
          </div>
          <div class="signature-pad-container" id="signature-ingeniero-container" data-signature="ingeniero">
            <div class="signature-placeholder">
              ‚úçÔ∏è Toque aqu√≠ para firmar
            </div>
          </div>
        </div>

        <!-- Firma Cliente -->
        <div class="signature-section">
          <h3>Cliente</h3>
          <div class="form-field">
            <label for="nombre-cliente-firma">Nombre completo</label>
            <input type="text" id="nombre-cliente-firma" placeholder="Nombre del cliente">
          </div>
          <div class="signature-pad-container" id="signature-cliente-container" data-signature="cliente">
            <div class="signature-placeholder">
              ‚úçÔ∏è Toque aqu√≠ para firmar
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Floating Action Button -->
    <button type="button" id="fab-generate" class="fab" title="Generar Informe">
      <span class="fab-icon">üìÑ</span>
    </button>

    <!-- Bottom Action Bar -->
    <div class="bottom-action-bar">
      <button type="button" id="save-draft" class="btn-action">
        üíæ Guardar
      </button>
      <button type="button" id="load-draft" class="btn-action">
        üìÇ Cargar
      </button>
      <button type="button" id="export-draft" class="btn-action">
        üì§ Exportar
      </button>
      <button type="button" id="import-draft" class="btn-action">
        üì• Importar
      </button>
      <button type="button" id="check-storage" class="btn-action">
        üíΩ Espacio
      </button>
      <button type="button" id="clear-all" class="btn-action btn-danger-outline">
        üóëÔ∏è Limpiar
      </button>
    </div>

    <!-- Status -->
    <div id="status" role="status" aria-live="polite"></div>
  </main>

  <!-- Modal para firmar -->
  <div id="signature-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content modal-signature">
      <div class="modal-header">
        <h3>‚úçÔ∏è Firmar</h3>
        <button type="button" class="modal-close-signature" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body">
        <canvas id="signature-modal-canvas" class="signature-canvas-large"></canvas>
        <div class="signature-modal-actions">
          <button type="button" id="clear-signature-modal" class="btn btn-secondary">
            üóëÔ∏è Borrar
          </button>
          <button type="button" id="save-signature-modal" class="btn btn-success">
            ‚úì Guardar Firma
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para a√±adir fotos -->
  <div id="photo-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üì∏ A√±adir Fotos</h3>
        <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body">
        <video id="camera-preview" autoplay playsinline class="hidden"></video>
        <canvas id="camera-snapshot" class="hidden"></canvas>
        
        <div class="photo-options">
          <button type="button" id="open-camera" class="btn btn-primary">
            üì∑ Usar C√°mara
          </button>
          <button type="button" id="take-photo" class="btn btn-success hidden">
            ‚úì Capturar
          </button>
          <button type="button" id="close-camera" class="btn btn-secondary hidden">
            ‚úï Cerrar C√°mara
          </button>
          <label for="file-input" class="btn btn-secondary">
            üìÅ Elegir Archivo
          </label>
          <input type="file" id="file-input" accept="image/*" class="hidden">
        </div>

        <div id="selected-photos" class="photo-grid"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="confirm-photos" class="btn btn-primary">
          ‚úì Confirmar Fotos
        </button>
      </div>
    </div>
  </div>

  <!-- Modal para cargar borradores -->
  <div id="draft-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üìÇ Borradores Guardados</h3>
        <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body">
        <div id="draft-list"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script type="module" src="assets/js/constants.js"></script>
  <script type="module" src="assets/js/state-selector.js"></script>
  <script type="module" src="assets/js/database.js"></script>
  <script type="module" src="assets/js/camera.js"></script>
  <script type="module" src="assets/js/forms.js"></script>
  <script type="module" src="assets/js/reports.js"></script>
  <script type="module" src="assets/js/app.js"></script>
</body>
</html>
