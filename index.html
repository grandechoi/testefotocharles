<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ReportManager - Valmet QCS</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header>
    <h1>ğŸ“‹ ReportManager</h1>
    <p class="subtitle">Informes QCS</p>
  </header>

  <!-- Tab Navigation -->
  <nav class="tab-navigation">
    <button class="tab-btn active" data-tab="datos">
      <span class="tab-icon">ğŸ“‹</span>
      <span class="tab-label">Datos</span>
    </button>
    <button class="tab-btn" data-tab="verificacion">
      <span class="tab-icon">âš™ï¸</span>
      <span class="tab-label">VerificaciÃ³n</span>
    </button>
    <button class="tab-btn" data-tab="observaciones">
      <span class="tab-icon">ğŸ“</span>
      <span class="tab-label">Observ.</span>
    </button>
    <button class="tab-btn" data-tab="firmas">
      <span class="tab-icon">âœï¸</span>
      <span class="tab-label">Firmas</span>
    </button>
  </nav>

  <main>
    <!-- Tab Content: Datos Generales -->
    <div class="tab-content active" id="tab-datos">
      <section class="card">
        <h2>ğŸ“‹ Datos Generales</h2>
      
      <div class="form-row">
        <div class="form-field">
          <label for="aÃ±o">AÃ±o</label>
          <input type="number" id="aÃ±o" placeholder="2025">
        </div>
        <div class="form-field">
          <label for="semana">Semana</label>
          <input type="number" id="semana" placeholder="1-52">
        </div>
      </div>

      <div class="form-field">
        <label for="empresa">Empresa</label>
        <input type="text" id="empresa" placeholder="Nombre de la empresa">
      </div>

      <div class="form-field">
        <label for="direccion">DirecciÃ³n</label>
        <input type="text" id="direccion" placeholder="DirecciÃ³n completa">
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="albaran">AlbarÃ¡n (NÂº de Proyecto)</label>
          <input type="text" id="albaran" placeholder="NÃºmero de albarÃ¡n">
        </div>
        <div class="form-field">
          <label for="cod-ingeniero">CÃ³digo Ingeniero</label>
          <input type="text" id="cod-ingeniero" placeholder="CÃ³digo">
        </div>
      </div>

      <div class="form-field">
        <label for="fecha-visita">Fecha de la Visita</label>
        <input type="date" id="fecha-visita">
      </div>

      <div class="form-field">
        <label for="ubicacion">UbicaciÃ³n del escÃ¡ner</label>
        <textarea id="ubicacion" rows="2" placeholder="UbicaciÃ³n..."></textarea>
      </div>

      <div class="form-field">
        <label for="perfiles">Perfiles en el aire</label>
        <textarea id="perfiles" rows="3" placeholder="Perfiles..."></textarea>
      </div>

      <div class="form-field">
        <label for="peticiones">Peticiones del cliente</label>
        <textarea id="peticiones" rows="3" placeholder="Peticiones..."></textarea>
      </div>

      <!-- Horas Trabajadas -->
      <div class="form-field">
        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">â±ï¸ Horas Trabajadas</h3>
        <div class="hours-table-container">
          <table class="hours-table" id="hours-table">
            <thead>
              <tr>
                <th>DÃAS</th>
                <th>FECHAS</th>
                <th>Horas de Viaje</th>
                <th>Horas normales<br>8h00...20h00<br>(Max 8 hrs)</th>
                <th>Horas Extras<br>20h00...8h00<br>(of&gt; 8 hrs)</th>
                <th>Horas<br>Sabados</th>
                <th>Horas Feriadas<br>y Domingos</th>
                <th>Commentarios</th>
              </tr>
            </thead>
            <tbody>
              <tr data-day="LUN">
                <td>LUN.</td>
                <td><input type="date" class="date-input" data-day="LUN"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="LUN" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="LUN" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="MAR">
                <td>MAR.</td>
                <td><input type="date" class="date-input" data-day="MAR"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MAR" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="MAR" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="MIER">
                <td>MIER.</td>
                <td><input type="date" class="date-input" data-day="MIER"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="MIER" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="MIER" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="JUE">
                <td>JUE.</td>
                <td><input type="date" class="date-input" data-day="JUE"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="JUE" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="JUE" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="VIER">
                <td>VIER.</td>
                <td><input type="date" class="date-input" data-day="VIER"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="VIER" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="VIER" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="SAB">
                <td>SAB.</td>
                <td><input type="date" class="date-input" data-day="SAB"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="SAB" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="SAB" placeholder="Comentarios..."></td>
              </tr>
              <tr data-day="DOM">
                <td>DOM.</td>
                <td><input type="date" class="date-input" data-day="DOM"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="viaje" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="normales" min="0" max="8" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="extras" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="sabados" min="0" step="0.5"></td>
                <td><input type="number" class="hours-input" data-day="DOM" data-col="feriados" min="0" step="0.5"></td>
                <td><input type="text" class="comment-input" data-day="DOM" placeholder="Comentarios..."></td>
              </tr>
              <tr class="total-row">
                <td colspan="2"><strong>TOTAL Hrs</strong></td>
                <td><strong id="total-viaje">0</strong></td>
                <td><strong id="total-normales">0</strong></td>
                <td><strong id="total-extras">0</strong></td>
                <td><strong id="total-sabados">0</strong></td>
                <td><strong id="total-feriados">0</strong></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    </div>

    <!-- Tab Content: VerificaciÃ³n -->
    <div class="tab-content" id="tab-verificacion">
      <section class="card">
        <h2>âš™ï¸ VerificaciÃ³n de Sistemas</h2>
        <p class="subtitle">Seleccione los estados de cada elemento</p>
        <div id="sections-container"></div>
      </section>
    </div>

    <!-- Tab Content: Observaciones -->
    <div class="tab-content" id="tab-observaciones">
      <section class="card">
        <h2>ğŸ“ Observaciones</h2>
        <div class="form-field">
          <label for="descripcion-visita">DescripciÃ³n de la visita</label>
          <textarea id="descripcion-visita" rows="4" placeholder="DescripciÃ³n detallada de la visita..."></textarea>
        </div>
        <div class="form-field">
          <label for="observaciones">Observaciones adicionales</label>
          <textarea id="observaciones" rows="5" placeholder="Observaciones adicionales..."></textarea>
        </div>
      </section>
    </div>

    <!-- Tab Content: Firmas -->
    <div class="tab-content" id="tab-firmas">
      <section class="card">
        <h2>âœï¸ Firmas Digitales</h2>
        
        <!-- Firma Ingeniero -->
        <div class="signature-section">
          <h3>Ingeniero Valmet</h3>
          <div class="form-field">
            <label for="nombre-ingeniero">Nombre completo</label>
            <input type="text" id="nombre-ingeniero" placeholder="Nombre del ingeniero">
          </div>
          <div class="signature-pad-container">
            <canvas id="signature-ingeniero" class="signature-canvas"></canvas>
            <div class="signature-actions">
              <button type="button" class="btn btn-secondary btn-small" id="clear-signature-ingeniero">
                ğŸ—‘ï¸ Borrar
              </button>
            </div>
          </div>
        </div>

        <!-- Firma Cliente -->
        <div class="signature-section">
          <h3>Cliente</h3>
          <div class="form-field">
            <label for="nombre-cliente-firma">Nombre completo</label>
            <input type="text" id="nombre-cliente-firma" placeholder="Nombre del cliente">
          </div>
          <div class="signature-pad-container">
            <canvas id="signature-cliente" class="signature-canvas"></canvas>
            <div class="signature-actions">
              <button type="button" class="btn btn-secondary btn-small" id="clear-signature-cliente">
                ğŸ—‘ï¸ Borrar
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Floating Action Button -->
    <button type="button" id="fab-generate" class="fab" title="Generar Informe">
      <span class="fab-icon">ğŸ“„</span>
    </button>

    <!-- Bottom Action Bar -->
    <div class="bottom-action-bar">
      <button type="button" id="save-draft" class="btn-action">
        ğŸ’¾ Guardar
      </button>
      <button type="button" id="load-draft" class="btn-action">
        ğŸ“‚ Cargar
      </button>
      <button type="button" id="check-storage" class="btn-action">
        ğŸ’½ Espacio
      </button>
      <button type="button" id="clear-all" class="btn-action btn-danger-outline">
        ğŸ—‘ï¸ Limpiar
      </button>
    </div>

    <!-- Status -->
    <div id="status" role="status" aria-live="polite"></div>
  </main>

  <!-- Modal para aÃ±adir fotos -->
  <div id="photo-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“¸ AÃ±adir Fotos</h3>
        <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body">
        <video id="camera-preview" autoplay playsinline class="hidden"></video>
        <canvas id="camera-snapshot" class="hidden"></canvas>
        
        <div class="photo-options">
          <button type="button" id="open-camera" class="btn btn-primary">
            ğŸ“· Usar CÃ¡mara
          </button>
          <button type="button" id="take-photo" class="btn btn-success hidden">
            âœ“ Capturar
          </button>
          <button type="button" id="close-camera" class="btn btn-secondary hidden">
            âœ• Cerrar CÃ¡mara
          </button>
          <label for="file-input" class="btn btn-secondary">
            ğŸ“ Elegir Archivo
          </label>
          <input type="file" id="file-input" accept="image/*" class="hidden">
        </div>

        <div id="selected-photos" class="photo-grid"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="confirm-photos" class="btn btn-primary">
          âœ“ Confirmar Fotos
        </button>
      </div>
    </div>
  </div>

  <!-- Modal para cargar borradores -->
  <div id="draft-modal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“‚ Borradores Guardados</h3>
        <button type="button" class="modal-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body">
        <div id="draft-list"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script type="module" src="assets/js/constants.js"></script>
  <script type="module" src="assets/js/state-selector.js"></script>
  <script type="module" src="assets/js/database.js"></script>
  <script type="module" src="assets/js/camera.js"></script>
  <script type="module" src="assets/js/forms.js"></script>
  <script type="module" src="assets/js/reports.js"></script>
  <script type="module" src="assets/js/app.js"></script>
</body>
</html>
